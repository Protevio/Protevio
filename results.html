<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="#1a1f2e">
<title>Search Results â€“ Protevio AI</title>
<meta name="robots" content="noindex,nofollow">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%235b9aff' rx='20' width='100' height='100'/><text x='50' y='68' text-anchor='middle' fill='white' font-size='55' font-weight='800' font-family='system-ui'>P</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
*{-webkit-tap-highlight-color:transparent}
:root{
  --bg:#1a1f2e;
  --bg-elevated:#232a3d;
  --bg-card:#2a3349;
  --border:#3a4562;
  --border-light:#4a5678;
  --text:#f8fafc;
  --text-secondary:#d1d5e0;
  --text-muted:#9ca3b8;
  --accent:#5b9aff;
  --accent-light:#85b4ff;
  --accent-glow:rgba(91,154,255,.15);
  --green:#4ade80;
  --purple:#a78bfa;
  --glass:rgba(42,51,73,.6);
  --glass-border:rgba(255,255,255,.08);
}
html{font-size:16px;scroll-behavior:smooth}
body{
  font-family:'Plus Jakarta Sans',system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}

/* Background effects */
.bg-gradient{
  position:fixed;inset:0;
  background:
    radial-gradient(ellipse 60% 50% at 20% 20%,rgba(91,154,255,.12) 0%,transparent 50%),
    radial-gradient(ellipse 50% 40% at 80% 80%,rgba(167,139,250,.08) 0%,transparent 50%),
    radial-gradient(ellipse 40% 30% at 50% 50%,rgba(74,222,128,.05) 0%,transparent 50%);
  pointer-events:none;z-index:0;
  animation:gradientShift 15s ease-in-out infinite;
}
@keyframes gradientShift{
  0%,100%{opacity:1;transform:scale(1)}
  50%{opacity:.8;transform:scale(1.05)}
}
.dot-pattern{
  position:fixed;inset:0;
  background-image:radial-gradient(rgba(91,154,255,.15) 1px,transparent 1px);
  background-size:32px 32px;
  pointer-events:none;z-index:0;opacity:.5;
}

/* ===== NAV ===== */
.nav{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 40px;
  background:rgba(26,31,46,.9);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--glass-border);
  position:sticky;top:0;z-index:100;
}
.nav__logo{display:flex;align-items:center;gap:12px;text-decoration:none}
.nav__logo-mark{width:36px;height:36px}
.nav__logo-mark svg{width:100%;height:100%}
.nav__logo-text{font-size:1.55rem;letter-spacing:.22em;color:var(--text);font-weight:800}
.nav__links{display:flex;align-items:center;gap:32px}
.nav__link{
  font-size:.88rem;font-weight:500;color:var(--text-muted);
  text-decoration:none;transition:color .25s;position:relative;
}
.nav__link:hover{color:var(--text)}
.nav__right{display:flex;align-items:center;gap:12px}
.nav__login{
  padding:9px 20px;font-size:.85rem;font-weight:600;color:white;
  background:linear-gradient(135deg,var(--accent) 0%,#7c6aff 100%);
  border:none;border-radius:10px;text-decoration:none;
  display:flex;align-items:center;gap:6px;transition:all .25s;
  box-shadow:0 4px 16px rgba(91,154,255,.35);position:relative;overflow:hidden;
}
.nav__login::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.15) 0%,transparent 50%)}
.nav__login:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(91,154,255,.45)}
.nav__login svg{width:12px;height:12px;stroke:currentColor;stroke-width:2.5;fill:none;position:relative;z-index:1}
.nav__login span{position:relative;z-index:1}

/* ===== INFO BAR ===== */
.info-bar{
  background:rgba(35,42,61,.5);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--glass-border);
  padding:16px 0;position:relative;z-index:1;
}
.info-bar__inner{max-width:1200px;margin:0 auto;padding:0 32px;display:flex;align-items:center;gap:16px}
.info-bar__thumb{
  width:48px;height:48px;border-radius:12px;object-fit:cover;
  border:2px solid var(--border);flex-shrink:0;background:var(--bg-elevated);
}
.info-bar__meta{flex:1}
.info-bar__plan{font-size:.74rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.06em}
.info-bar__plan--paid{color:var(--green)}
.info-bar__stats{font-size:.85rem;color:var(--text-muted)}
.info-bar__stats strong{color:var(--text-secondary)}
.info-bar__actions{display:flex;align-items:center;gap:10px}
.info-bar__btn{
  padding:8px 18px;border-radius:10px;font-size:.82rem;font-weight:600;
  cursor:pointer;font-family:inherit;display:flex;align-items:center;gap:7px;
  border:none;transition:all .2s;text-decoration:none;
}
.info-bar__btn--outline{
  background:var(--glass);border:1px solid var(--border);color:var(--text-secondary);
}
.info-bar__btn--outline:hover{border-color:var(--border-light);color:var(--text);transform:translateY(-1px)}
.info-bar__btn--report{
  background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;
  box-shadow:0 2px 8px rgba(220,38,38,.2);
}
.info-bar__btn--report:hover{box-shadow:0 4px 16px rgba(220,38,38,.35);transform:translateY(-1px)}
.info-bar__btn svg{width:15px;height:15px;stroke:currentColor;stroke-width:2;fill:none}

/* ===== CTA SECTION (unified unlock/trial/summary) ===== */
.cta-section{
  max-width:1200px;margin:0 auto;padding:20px 32px 0;
  position:relative;z-index:1;display:none;
}
.cta-card{
  background:var(--bg-elevated);
  border:1px solid var(--border);
  border-radius:16px;
  overflow:hidden;
}
/* Summary row */
.cta-summary{
  padding:18px 24px;
  display:flex;align-items:flex-start;gap:12px;
  border-bottom:1px solid rgba(255,255,255,.04);
}
.cta-summary__icon{
  width:36px;height:36px;border-radius:10px;flex-shrink:0;
  background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.15);
  display:flex;align-items:center;justify-content:center;
}
.cta-summary__icon svg{width:18px;height:18px;stroke:#f59e0b;stroke-width:2;fill:none}
.cta-summary__text{flex:1;min-width:0}
.cta-summary__title{font-size:.9rem;font-weight:700;color:var(--text)}
.cta-summary__detail{font-size:.8rem;color:var(--text-muted);margin-top:3px}
.cta-summary__domains{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.cta-summary__domain{
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
  border-radius:6px;padding:4px 11px;font-size:.74rem;color:var(--text-secondary);
  display:flex;align-items:center;gap:5px;
}
.cta-summary__domain svg{width:11px;height:11px;stroke:currentColor;stroke-width:2;fill:none;opacity:.5}

/* CTA options row */
.cta-options{display:flex;align-items:stretch}
.cta-option{
  flex:1;padding:16px 24px;
  display:flex;align-items:center;justify-content:space-between;gap:14px;
  cursor:default;
}
.cta-option + .cta-option{border-left:1px solid rgba(255,255,255,.04)}
.cta-option__info{min-width:0}
.cta-option__label{font-size:.82rem;font-weight:700;color:var(--text)}
.cta-option__sub{font-size:.74rem;color:var(--text-muted);margin-top:2px}
.cta-option__btn{
  padding:9px 20px;border-radius:50px;font-family:inherit;
  font-size:.82rem;font-weight:700;cursor:pointer;
  white-space:nowrap;display:flex;align-items:center;gap:6px;
  transition:all .2s;border:none;flex-shrink:0;
}
.cta-option__btn--unlock{
  background:linear-gradient(135deg,#1d4ed8,#2563eb);color:#fff;
  box-shadow:0 2px 10px rgba(29,78,216,.25);
}
.cta-option__btn--unlock:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(29,78,216,.4)}
.cta-option__btn--trial{
  background:linear-gradient(135deg,#7c3aed,#6d28d9);color:#fff;
  box-shadow:0 2px 10px rgba(124,58,237,.25);
}
.cta-option__btn--trial:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(124,58,237,.4)}
.cta-option__btn:disabled{opacity:.6;cursor:not-allowed;transform:none!important}
.cta-option__btn svg{width:14px;height:14px;stroke:currentColor;stroke-width:2;fill:none}

/* ===== GRID ===== */
.results{max-width:1200px;margin:0 auto;padding:24px 32px;position:relative;z-index:1}
.results__grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;display:none}

/* ===== CARD ===== */
.card{
  border-radius:14px;overflow:hidden;cursor:pointer;transition:all .25s;
  background:var(--bg-elevated);border:1px solid transparent;position:relative;
}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 28px rgba(0,0,0,.4);border-color:var(--border)}
.card__wrap{position:relative;width:100%;aspect-ratio:1;overflow:hidden;background:var(--bg)}
.card__img{width:100%;height:100%;object-fit:cover;transition:transform .3s}
.card:hover .card__img{transform:scale(1.02)}

/* Locked - pixelation with face reveal */
.card--locked .card__img{opacity:0}
.card--locked .card__pixelated{display:block}
.card--locked .card__reveal{display:block}
.card__pixelated{
  display:none;position:absolute;inset:0;width:100%;height:100%;
  object-fit:cover;image-rendering:pixelated;z-index:0;
}
/* Fallback if canvas pixelation fails - use blur */
.card__pixelated.fallback{
  image-rendering:auto;
  filter:blur(8px) saturate(.5);transform:scale(1.08);
}
.card__reveal{
  display:none;position:absolute;inset:0;width:100%;height:100%;
  object-fit:cover;z-index:1;
  clip-path:ellipse(30% 34% at 50% 42%);
  transition:clip-path .35s ease;
}
.card--locked .card__noise{display:block}
.card--locked.card--teaser .card__noise{opacity:.15}
.card__noise{display:none;position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");background-size:128px;opacity:.25;z-index:2;pointer-events:none}

/* Badges */
.card__explicit{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);padding:4px 10px;border-radius:6px;font-size:.66rem;font-weight:700;color:#fff;z-index:3;display:flex;align-items:center;gap:4px;letter-spacing:.02em}
.card__explicit span{background:rgba(255,255,255,.2);padding:1px 5px;border-radius:3px;font-weight:800}
.card__tap{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.08);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.1);padding:5px 12px;border-radius:7px;font-size:.74rem;font-weight:600;color:rgba(255,255,255,.8);z-index:3;display:none;align-items:center;gap:5px}
.card--locked .card__tap{display:flex}
.card__tap svg{width:13px;height:13px;stroke:currentColor;stroke-width:2;fill:none}
.card__domain{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,.45);backdrop-filter:blur(6px);padding:4px 10px;border-radius:5px;font-size:.72rem;color:var(--text-secondary);font-weight:500;z-index:3;max-width:calc(100% - 90px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card__sim{position:absolute;bottom:10px;right:10px;background:rgba(91,154,255,.12);border:1px solid rgba(91,154,255,.15);padding:4px 8px;border-radius:5px;font-size:.7rem;color:var(--accent);font-weight:700;z-index:3}

/* Tease animation - briefly expand reveal on click */
.card--locked.tease .card__reveal{clip-path:ellipse(45% 50% at 50% 42%)}
.card--locked.tease .card__tap{opacity:0;transition:opacity .25s}
.card--locked.tease .card__noise{opacity:.1;transition:opacity .25s}

/* ===== MODAL ===== */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal-bg.open{display:flex}
.modal{
  background:linear-gradient(170deg,var(--bg-elevated) 0%,var(--bg) 100%);
  border:1px solid var(--border);border-radius:20px;width:420px;max-height:88vh;
  overflow-y:auto;box-shadow:0 25px 60px rgba(0,0,0,.6);
  color:var(--text-secondary);position:relative;
}
@keyframes modalIn{from{opacity:0;transform:scale(.96) translateY(8px)}to{opacity:1;transform:none}}
.modal-bg.open .modal{animation:modalIn .2s ease}
.modal__close{
  position:absolute;top:12px;right:12px;width:32px;height:32px;
  background:rgba(0,0,0,.5);backdrop-filter:blur(4px);border-radius:50%;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  color:#9ca3af;font-size:15px;font-weight:600;z-index:10;
  border:1px solid rgba(255,255,255,.08);transition:all .15s;
}
.modal__close:hover{background:rgba(255,255,255,.1);color:#fff}
.modal__img-wrap{position:relative;width:100%;aspect-ratio:4/3;overflow:hidden;border-radius:20px 20px 0 0;background:var(--bg)}
.modal__img{width:100%;height:100%;object-fit:cover}
.modal__img--locked{image-rendering:pixelated}
.modal__img-reveal{
  position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1;
  clip-path:ellipse(28% 32% at 50% 40%);
}
.modal__lock{position:absolute;inset:0;display:none;flex-direction:column;align-items:center;justify-content:center;gap:6px;z-index:2}
.modal__lock svg{width:40px;height:40px;stroke:rgba(255,255,255,.75);stroke-width:1.5;fill:none}
.modal__lock-text{color:#fff;font-weight:700;font-size:.95rem;text-shadow:0 2px 8px rgba(0,0,0,.5)}
.modal__lock-sub{color:rgba(255,255,255,.5);font-size:.78rem}
.modal__domain-badge{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);padding:5px 12px;border-radius:6px;font-size:.78rem;color:#e2e8f0;font-weight:600;z-index:3}

/* Action rows */
.modal__action{display:flex;align-items:center;gap:14px;padding:14px 20px;cursor:pointer;transition:background .12s;border-bottom:1px solid rgba(255,255,255,.04)}
.modal__action:hover{background:rgba(255,255,255,.03)}
.modal__action--disabled{opacity:.3;cursor:not-allowed}
.modal__action--disabled:hover{background:transparent}
.modal__action-icon{
  width:36px;height:36px;border-radius:10px;
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.modal__action-icon svg{width:20px;height:20px;fill:none}
.modal__action-body{flex:1;min-width:0}
.modal__action-title{font-size:.86rem;font-weight:600;color:var(--text)}
.modal__action-sub{font-size:.74rem;color:var(--text-muted);margin-top:1px}
.modal__action-chevron{width:18px;height:18px;stroke:var(--text-muted);stroke-width:2;fill:none;flex-shrink:0}
.modal__footer{padding:12px 20px;font-size:.73rem;color:var(--text-muted);border-top:1px solid rgba(255,255,255,.04)}

/* ===== EMPTY STATE ===== */
.empty-state{display:none;position:relative;z-index:1}
.empty-state__inner{
  max-width:560px;margin:0 auto;padding:80px 24px;text-align:center;
}
.empty-state__icon{
  width:80px;height:80px;margin:0 auto 28px;border-radius:20px;
  background:rgba(91,154,255,.08);border:1px solid rgba(91,154,255,.12);
  display:flex;align-items:center;justify-content:center;
}
.empty-state__icon svg{width:36px;height:36px;stroke:var(--accent);stroke-width:1.5;fill:none}
.empty-state__title{font-size:1.4rem;font-weight:800;color:var(--text);margin-bottom:10px}
.empty-state__desc{font-size:.92rem;color:var(--text-muted);line-height:1.65;margin-bottom:28px}
.empty-state__desc strong{color:var(--text-secondary);font-weight:600}
.empty-state__actions{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap}
.empty-state__btn{
  padding:12px 28px;border-radius:12px;font-family:inherit;font-size:.88rem;
  font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;
  transition:all .2s;border:none;text-decoration:none;
}
.empty-state__btn--primary{
  background:linear-gradient(135deg,var(--accent),#7c6aff);color:#fff;
  box-shadow:0 4px 16px rgba(91,154,255,.35);
}
.empty-state__btn--primary:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(91,154,255,.45)}
.empty-state__btn--secondary{
  background:var(--glass);border:1px solid var(--border);color:var(--text-secondary);
}
.empty-state__btn--secondary:hover{border-color:var(--border-light);color:var(--text);transform:translateY(-1px)}
.empty-state__btn svg{width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none}
.empty-state__stats{
  margin-top:36px;padding:20px 28px;
  background:var(--bg-elevated);border:1px solid var(--border);border-radius:14px;
  display:flex;align-items:center;gap:14px;text-align:left;
}
.empty-state__stats-icon{
  width:40px;height:40px;border-radius:10px;flex-shrink:0;
  background:rgba(74,222,128,.08);border:1px solid rgba(74,222,128,.12);
  display:flex;align-items:center;justify-content:center;
}
.empty-state__stats-icon svg{width:20px;height:20px;stroke:var(--green);stroke-width:2;fill:none}
.empty-state__stats-text{font-size:.82rem;color:var(--text-muted);line-height:1.5}
.empty-state__stats-text strong{color:var(--green);font-weight:700}

/* ===== LOADING ===== */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:120px 24px;gap:16px;position:relative;z-index:1}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== FOOTER ===== */
.footer{
  border-top:1px solid var(--border);padding:28px 24px;margin-top:60px;
  text-align:center;color:var(--text-muted);font-size:.82rem;
  position:relative;z-index:1;
}
.footer__links{margin-bottom:10px}
.footer__links a{color:var(--accent);text-decoration:none;margin:0 12px;transition:color .2s}
.footer__links a:hover{color:var(--accent-light)}

/* ===== RESPONSIVE ===== */
@media(max-width:900px){
  .results__grid{grid-template-columns:repeat(2,1fr);gap:12px}
  .nav{padding:14px 24px}
  .nav__links{gap:20px}
  .nav__link{font-size:.82rem}
  .cta-options{flex-direction:column}
  .cta-option + .cta-option{border-left:none;border-top:1px solid rgba(255,255,255,.04)}
}
@media(max-width:600px){
  .results__grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .results{padding:16px}
  .nav{padding:12px 16px}
  .nav__links{display:none}
  .nav__link{font-size:.78rem}
  .info-bar__inner{padding:0 16px;gap:10px}
  .info-bar__btn span{display:none}
  .cta-section{padding:16px 16px 0}
  .cta-summary{padding:16px 18px}
  .cta-option{padding:14px 18px;flex-wrap:wrap;gap:10px}
  .cta-option__btn{width:100%;;justify-content:center}
  .modal{width:95%;max-width:none;border-radius:16px}
  .modal__img-wrap{border-radius:16px 16px 0 0}
  .card__explicit{font-size:.58rem;padding:3px 7px}
  .card__tap{font-size:.66rem;padding:4px 8px}
  .card__domain{font-size:.64rem;padding:3px 7px;max-width:calc(100% - 70px)}
  .card__sim{font-size:.62rem;padding:3px 6px}
  .empty-state__inner{padding:60px 20px}
  .empty-state__title{font-size:1.2rem}
  .empty-state__stats{flex-direction:column;text-align:center;gap:10px}
}

/* Scrollbar */
.modal::-webkit-scrollbar{width:6px}
.modal::-webkit-scrollbar-track{background:transparent}
.modal::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
</style>
</head>
<body>

<!-- Background effects -->
<div class="bg-gradient"></div>
<div class="dot-pattern"></div>

<!-- NAV -->
<nav class="nav">
  <a href="/" class="nav__logo">
    <div class="nav__logo-mark">
      <svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="18,2 33,10 33,26 18,34 3,26 3,10" stroke="url(#hexGrad)" stroke-width="1.4" fill="none"/>
        <circle cx="18" cy="18" r="5.5" fill="url(#hexGrad)" opacity=".9"/>
        <circle cx="18" cy="18" r="2" fill="#1a1f2e"/>
        <defs>
          <linearGradient id="hexGrad" x1="0" y1="0" x2="36" y2="36">
            <stop offset="0%" stop-color="#00e5ff"/>
            <stop offset="100%" stop-color="#7c4dff"/>
          </linearGradient>
        </defs>
      </svg>
    </div>
    <span class="nav__logo-text">PROTEVIO</span>
  </a>
  <div class="nav__links">
    <a href="/" class="nav__link">Search</a>
    <a href="/pricing.html" class="nav__link">Pricing</a>
    <a href="/blog.html" class="nav__link">Blog</a>
    <a href="/opt-out.html" class="nav__link">Opt-out</a>
    <a href="/faq.html" class="nav__link">FAQ</a>
    <a href="/contact.html" class="nav__link">Contact</a>
  </div>
  <div class="nav__right">
    <a href="/login.html" class="nav__login" id="navAuth">
      <span>Log In</span>
      <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </a>
  </div>
</nav>

<!-- INFO BAR -->
<div class="info-bar">
  <div class="info-bar__inner">
    <img class="info-bar__thumb" id="faceThumb" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><rect fill='%23232a3d' width='50' height='50' rx='12'/><text x='25' y='32' text-anchor='middle' fill='%239ca3b8' font-size='18'>ðŸ‘¤</text></svg>" alt="">
    <div class="info-bar__meta">
      <div class="info-bar__plan" id="planLabel">Free Search</div>
      <div class="info-bar__stats">About <strong id="statCount">â€“</strong> results in <strong id="statTime">â€“</strong></div>
    </div>
    <div class="info-bar__actions">
      <a href="/" class="info-bar__btn info-bar__btn--outline">
        <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span>New Search</span>
      </a>
      <button class="info-bar__btn info-bar__btn--report" id="pdfBtn" style="display:none">
        <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        <span>Generate report</span>
      </button>
    </div>
  </div>
</div>

<!-- CTA SECTION (unified - shown to free users only) -->
<div class="cta-section" id="ctaSection">
  <div class="cta-card">
    <!-- Summary -->
    <div class="cta-summary">
      <div class="cta-summary__icon">
        <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </div>
      <div class="cta-summary__text">
        <div class="cta-summary__title" id="summaryTitle">Your face was found on multiple websites</div>
        <div class="cta-summary__detail" id="summaryDetail">We detected matches across different online sources. Unlock to see full details.</div>
        <div class="cta-summary__domains" id="summaryDomains"></div>
      </div>
    </div>
    <!-- Options -->
    <div class="cta-options">
      <div class="cta-option" id="unlockOption">
        <div class="cta-option__info">
          <div class="cta-option__label">Unlock this search for 9,99 â‚¬</div>
          <div class="cta-option__sub">One-time payment Â· See sources & unblurred photos</div>
        </div>
        <button class="cta-option__btn cta-option__btn--unlock" id="unlockBtn">
          <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Unlock
        </button>
      </div>
      <div class="cta-option" id="trialOption" style="display:none">
        <div class="cta-option__info">
          <div class="cta-option__label">Or try 3 days free</div>
          <div class="cta-option__sub">Full access Â· Cancel anytime Â· â‚¬24.99/mo after</div>
        </div>
        <button class="cta-option__btn cta-option__btn--trial" id="trialBarBtn">
          <svg viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
          <span id="trialBarBtnText">Start Trial</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MAIN RESULTS -->
<main class="results">
  <div class="loading" id="loadingState">
    <div class="spinner"></div>
    <div style="font-size:.85rem;color:var(--text-muted)">Loading results...</div>
  </div>
  <div class="results__grid" id="grid"></div>
</main>

<!-- EMPTY STATE (no results) -->
<div class="empty-state" id="noResults">
  <div class="empty-state__inner">
    <div class="empty-state__icon">
      <svg viewBox="0 0 24 24"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
    </div>
    <h2 class="empty-state__title">Good news â€” no matches found</h2>
    <p class="empty-state__desc">
      We searched across our database and didn't find your face on any indexed websites. 
      That's a positive sign for your online privacy.<br><br>
      Our database grows by <strong>~30,000 new faces every day</strong>, so we recommend 
      checking back periodically to stay on top of where your image might appear in the future.
    </p>
    <div class="empty-state__actions">
      <a href="/" class="empty-state__btn empty-state__btn--primary">
        <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Try Another Photo
      </a>
      <a href="/pricing.html" class="empty-state__btn empty-state__btn--secondary">
        <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        Set Up Monitoring
      </a>
    </div>
    <div class="empty-state__stats">
      <div class="empty-state__stats-icon">
        <svg viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
      </div>
      <div class="empty-state__stats-text">
        Our crawlers are continuously scanning the web. We index <strong>~30,000 new faces daily</strong> 
        across thousands of websites. Check back in a few days for the most up-to-date results.
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <div class="modal__close" id="modalClose">âœ•</div>
    <div class="modal__img-wrap">
      <img class="modal__img" id="modalImg" src="" alt="Match">
      <img class="modal__img-reveal" id="modalReveal" src="" alt="" style="display:none">
      <div class="modal__lock" id="modalLock">
        <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        <div class="modal__lock-text">Unlock to reveal</div>
        <div class="modal__lock-sub" id="modalLockPct"></div>
      </div>
      <div class="modal__domain-badge" id="modalDomainBadge">â€“</div>
    </div>
    <div id="modalActions">
      <div class="modal__action" id="actWebsite">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#3b82f6" stroke-width="1.8"/><path d="M2 12h20" stroke="#3b82f6" stroke-width="1.2" opacity=".4"/><path d="M12 2c2.5 2.5 4 6 4 10s-1.5 7.5-4 10c-2.5-2.5-4-6-4-10s1.5-7.5 4-10z" stroke="#3b82f6" stroke-width="1.2" fill="none"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Open website</div>
          <div class="modal__action-sub">Visit the website where this image appears</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="modal__action" id="actImage">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="3" stroke="#8b5cf6" stroke-width="1.8"/><circle cx="8.5" cy="8.5" r="1.5" fill="#8b5cf6"/><path d="M21 15l-5-5L5 21" stroke="#8b5cf6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Open image</div>
          <div class="modal__action-sub">Access the unblurred source image</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="modal__action" id="actSearch">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" stroke="#06b6d4" stroke-width="1.8"/><line x1="21" y1="21" x2="16.65" y2="16.65" stroke="#06b6d4" stroke-width="1.8" stroke-linecap="round"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Search with this image</div>
          <div class="modal__action-sub">Start a new search using this photo</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="modal__action" id="actCopy">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" stroke="#6366f1" stroke-width="1.8"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke="#6366f1" stroke-width="1.8"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Copy Result ID</div>
          <div class="modal__action-sub">Copy the unique identifier for this result</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="modal__action" id="actExclude">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="#10b981" stroke-width="1.8"/><polyline points="9 12 11 14 15 10" stroke="#10b981" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Exclude from results</div>
          <div class="modal__action-sub">Remove this photo from Protevio's search</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="modal__action" id="actShare">
        <div class="modal__action-icon">
          <svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3" stroke="#ef4444" stroke-width="1.8"/><circle cx="6" cy="12" r="3" stroke="#ef4444" stroke-width="1.8"/><circle cx="18" cy="19" r="3" stroke="#ef4444" stroke-width="1.8"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" stroke="#ef4444" stroke-width="1.8"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" stroke="#ef4444" stroke-width="1.8"/></svg>
        </div>
        <div class="modal__action-body">
          <div class="modal__action-title">Share</div>
          <div class="modal__action-sub">Let friends know about Protevio</div>
        </div>
        <svg class="modal__action-chevron" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
    </div>
    <div class="modal__footer" id="modalFooter">Indexed on â€“</div>
  </div>
</div>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer__links">
    <a href="/privacy-policy.html">Privacy Policy</a>
    <a href="/terms-of-service.html">Terms of Service</a>
    <a href="/about.html">About</a>
    <a href="/contact.html">Contact</a>
    <a href="/opt-out.html">Opt-Out</a>
  </div>
  <p>Â© 2026 Protevio AI. All rights reserved.</p>
</footer>

<script>
const API='https://api.protevio.com/api';
function encImg(f){if(!f)return '';return API+'/img/'+btoa(f).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'')}
function getToken(){return localStorage.getItem('protevio_token')}

let results=[],searchId='',userPlan='free',isUnlocked=false,isFree=true,currentMatch=null,trialAvailable=false;

// ===== NAV AUTH STATE =====
(function(){
  const token=getToken();
  const navAuth=document.getElementById('navAuth');
  if(token && navAuth){
    try{
      const user=JSON.parse(localStorage.getItem('protevio_user')||'{}');
      navAuth.href='/dashboard.html';
      navAuth.querySelector('span').textContent=user.email?user.email.split('@')[0]:'Dashboard';
    }catch(e){/* keep default */}
  }
})();

// ===== INIT =====
(async function init(){
  const raw=sessionStorage.getItem('protevio_results');
  if(!raw){window.location.href='/';return}
  try{
    const d=JSON.parse(raw);
    if(Date.now()-d.timestamp>30*60*1000){sessionStorage.removeItem('protevio_results');window.location.href='/';return}
    results=d.results||[];searchId=d.search_id||'';userPlan=d.userPlan||'free';isUnlocked=d.isUnlocked||false;
    isFree=(userPlan==='free')&&!isUnlocked;
    if(d.faceThumb){document.getElementById('faceThumb').src=d.faceThumb}
  }catch(e){window.location.href='/';return}
  // Check trial availability for free users
  if(isFree){
    const token=getToken();
    if(token){try{
      const res=await fetch(API+'/trial/status',{headers:{'Authorization':'Bearer '+token}});
      if(res.ok){const ts=await res.json();trialAvailable=ts.trial_available||false}
    }catch(e){}}
  }
  render();
})();

// ===== PIXELATION HELPER =====
function pixelate(imgEl, pixelSize){
  return new Promise(resolve=>{
    const done=()=>{
      try{
        const c=document.createElement('canvas');
        const ctx=c.getContext('2d');
        const w=imgEl.naturalWidth||imgEl.width;
        const h=imgEl.naturalHeight||imgEl.height;
        if(!w||!h){resolve(null);return}
        c.width=w;c.height=h;
        const sw=Math.max(1,Math.floor(w/pixelSize));
        const sh=Math.max(1,Math.floor(h/pixelSize));
        ctx.imageSmoothingEnabled=false;
        ctx.drawImage(imgEl,0,0,sw,sh);
        ctx.drawImage(c,0,0,sw,sh,0,0,w,h);
        resolve(c.toDataURL('image/jpeg',0.7));
      }catch(e){
        // CORS or other canvas error - return null so we fall back to CSS blur
        resolve(null);
      }
    };
    if(imgEl.complete&&imgEl.naturalWidth)done();
    else{imgEl.onload=done;imgEl.onerror=()=>resolve(null)}
  });
}

function render(){
  document.getElementById('loadingState').style.display='none';
  const grid=document.getElementById('grid');
  if(!results.length){document.getElementById('noResults').style.display='block';return}
  grid.style.display='grid';

  // Stats
  document.getElementById('statCount').textContent=results.length;
  document.getElementById('statTime').textContent=((Math.random()*1.5)+.8).toFixed(2)+'s';

  // Plan label
  const pl=document.getElementById('planLabel');
  if(!isFree){pl.textContent='Full Access';pl.classList.add('info-bar__plan--paid')}

  // Buttons
  if(!isFree)document.getElementById('pdfBtn').style.display='flex';

  // CTA section for free users
  if(isFree){
    const ctaSection=document.getElementById('ctaSection');
    ctaSection.style.display='block';

    if(trialAvailable)document.getElementById('trialOption').style.display='flex';

    // Count unique domains
    const domains=[...new Set(results.map(r=>r.domain).filter(Boolean))];
    const domainCount=domains.length;

    document.getElementById('summaryTitle').textContent=
      results.length===1
        ?'Your face was found on 1 website'
        :'Your face was found across '+(domainCount||results.length)+' '+(domainCount>1?'different websites':'source'+(results.length>1?'s':''));

    document.getElementById('summaryDetail').textContent=
      results.length+' match'+(results.length!==1?'es':'')+' detected with up to '+Math.round(Math.max(...results.map(r=>r.similarity||0)))+'% similarity. Unlock to see full URLs and unblurred images.';

    // Show partial domain names as tags
    const domainsEl=document.getElementById('summaryDomains');
    domains.slice(0,6).forEach(d=>{
      domainsEl.innerHTML+='<div class="cta-summary__domain"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>'+d+'</div>';
    });
    if(domains.length>6){
      domainsEl.innerHTML+='<div class="cta-summary__domain" style="color:var(--accent)">+'+(domains.length-6)+' more</div>';
    }
  }

  // Cards
  results.forEach((m,i)=>{
    const card=document.createElement('div');
    const isTeaser=isFree&&i<3;
    card.className='card'+(isFree?' card--locked':'')+(isTeaser?' card--teaser':'');
    const sim=Math.round(m.similarity||0);
    const domain=m.domain||'';
    const imgUrl=encImg(m.filename||'');
    const explicit=m.nsfw||(m.category&&m.category!=='safe');
    const fallbackSvg='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23232a3d%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%239ca3b8%22 font-size=%2210%22>No image</text></svg>';

    let displayDomain=domain;
    if(isFree){
      if(isTeaser&&domain){displayDomain=domain}
      else{displayDomain='â€¢â€¢â€¢â€¢â€¢.com'}
    }

    card.innerHTML=
      '<div class="card__wrap">'+
        '<img class="card__img" src="'+imgUrl+'" alt="Match" loading="lazy" crossorigin="anonymous" onerror="this.src=\''+fallbackSvg+'\'">' +
        (isFree?'<img class="card__pixelated" src="'+fallbackSvg+'" alt="">':'') +
        (isFree?'<img class="card__reveal" src="'+imgUrl+'" alt="" loading="lazy" crossorigin="anonymous" onerror="this.style.display=\'none\'">':'') +
        '<div class="card__noise"></div>'+
        (explicit?'<div class="card__explicit"><span>E</span> POTENTIALLY EXPLICIT RESULT</div>':'')+
        '<div class="card__tap"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>'+(isTeaser?'Upgrade to reveal':'Tap to see')+'</div>'+
        '<div class="card__domain">'+displayDomain+'</div>'+
        '<div class="card__sim">'+sim+'%</div>'+
      '</div>';

    // Generate pixelated version for locked cards
    if(isFree){
      const origImg=card.querySelector('.card__img');
      const pixImg=card.querySelector('.card__pixelated');
      const doPixelate=()=>{
        pixelate(origImg, isTeaser?12:8).then(dataUrl=>{
          if(dataUrl){
            pixImg.src=dataUrl;
          }else{
            // Fallback: use original image with CSS blur
            pixImg.src=origImg.src;
            pixImg.classList.add('fallback');
          }
        });
      };
      if(origImg.complete&&origImg.naturalWidth)doPixelate();
      else origImg.addEventListener('load',doPixelate);
    }

    card.addEventListener('click',()=>{
      if(isFree){card.classList.add('tease');setTimeout(()=>{card.classList.remove('tease');openModal(m)},400)}
      else openModal(m);
    });

    card.style.opacity='0';card.style.transform='translateY(16px)';
    card.style.transition='opacity .35s ease,transform .35s ease';
    setTimeout(()=>{card.style.opacity='1';card.style.transform='none'},40+i*25);
    grid.appendChild(card);
  });
}

// ===== MODAL =====
function openModal(m){
  currentMatch=m;
  const sim=Math.round(m.similarity||0);
  const domain=m.domain||'Unknown';
  const imgSrc=encImg(m.filename||'');
  
  const modalImg=document.getElementById('modalImg');
  const modalReveal=document.getElementById('modalReveal');
  
  if(isFree){
    // Pixelate for modal
    const tmpImg=new Image();
    tmpImg.crossOrigin='anonymous';
    tmpImg.onload=()=>{
      pixelate(tmpImg,8).then(dataUrl=>{
        if(dataUrl){
          modalImg.src=dataUrl;
          modalImg.className='modal__img modal__img--locked';
        }else{
          // Fallback: use original with CSS blur
          modalImg.src=imgSrc;
          modalImg.className='modal__img modal__img--locked';
          modalImg.style.filter='blur(10px) saturate(.5)';
          modalImg.style.transform='scale(1.1)';
        }
      });
    };
    tmpImg.onerror=()=>{
      modalImg.src=imgSrc;
      modalImg.className='modal__img modal__img--locked';
      modalImg.style.filter='blur(10px) saturate(.5)';
      modalImg.style.transform='scale(1.1)';
    };
    tmpImg.src=imgSrc;
    modalReveal.src=imgSrc;
    modalReveal.style.display='block';
  }else{
    modalImg.src=imgSrc;
    modalImg.className='modal__img';
    modalImg.style.filter='';
    modalImg.style.transform='';
    modalReveal.style.display='none';
  }
  
  document.getElementById('modalDomainBadge').textContent=isFree?'â€¢â€¢â€¢â€¢â€¢.com':domain;
  document.getElementById('modalLock').style.display=isFree?'flex':'none';
  document.getElementById('modalLockPct').textContent=sim+'% match';
  document.getElementById('modalFooter').textContent='Indexed on '+(m.indexed_at||new Date().toISOString().slice(0,10));

  ['actWebsite','actImage','actExclude'].forEach(id=>{
    const el=document.getElementById(id);
    el.classList.toggle('modal__action--disabled',isFree);
  });
  document.getElementById('modalBg').classList.add('open');
}

function closeModal(){document.getElementById('modalBg').classList.remove('open');currentMatch=null}
document.getElementById('modalClose').onclick=closeModal;
document.getElementById('modalBg').onclick=e=>{if(e.target===e.currentTarget)closeModal()};
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});

// Modal action handlers
document.getElementById('actWebsite').onclick=()=>{
  if(isFree||!currentMatch)return;
  const u=currentMatch.page_url||currentMatch.url;if(u)window.open(u,'_blank');
};
document.getElementById('actImage').onclick=()=>{
  if(isFree||!currentMatch)return;
  if(currentMatch.url)window.open(currentMatch.url,'_blank');
};
document.getElementById('actSearch').onclick=()=>{
  window.location.href='/';
};
document.getElementById('actCopy').onclick=()=>{
  if(!currentMatch)return;
  navigator.clipboard.writeText(currentMatch.id||currentMatch.filename||'').then(()=>{
    const t=document.querySelector('#actCopy .modal__action-title');
    t.textContent='Copied!';setTimeout(()=>t.textContent='Copy Result ID',1500);
  });
};
document.getElementById('actExclude').onclick=()=>{
  if(isFree||!currentMatch)return;
  alert('Exclusion request submitted for '+(currentMatch.domain||'this result'));
};
document.getElementById('actShare').onclick=()=>{
  const text='I found my face online using Protevio AI!\nCheck where YOUR face appears â†’ https://protevio.com';
  if(navigator.share){navigator.share({text,url:'https://protevio.com'}).catch(()=>{})}
  else{navigator.clipboard.writeText(text).then(()=>{
    const t=document.querySelector('#actShare .modal__action-title');
    t.textContent='Link copied!';setTimeout(()=>t.textContent='Share',1500);
  })}
};

// ===== TRIAL (Stripe checkout) =====
document.getElementById('trialBarBtn').addEventListener('click',async()=>{
  const token=getToken();
  if(!token){window.location.href='/login.html';return}
  const btn=document.getElementById('trialBarBtn');
  document.getElementById('trialBarBtnText').textContent='Redirecting...';
  btn.disabled=true;
  try{
    const res=await fetch(API+'/checkout-trial',{method:'POST',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'}});
    const data=await res.json();
    if(data.url){window.location.href=data.url}
    else{alert(data.error||'Could not start trial');document.getElementById('trialBarBtnText').textContent='Start Trial';btn.disabled=false}
  }catch(e){alert('Connection error');document.getElementById('trialBarBtnText').textContent='Start Trial';btn.disabled=false}
});

// ===== UNLOCK =====
document.getElementById('unlockBtn').addEventListener('click',async()=>{
  const token=getToken();if(!token){window.location.href='/';return}
  localStorage.setItem('protevio_pending_unlock',JSON.stringify({search_id:searchId,results}));
  const btn=document.getElementById('unlockBtn');btn.textContent='Redirecting...';btn.disabled=true;
  try{
    const res=await fetch(API+'/checkout-single',{method:'POST',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify({search_id:searchId})});
    const data=await res.json();
    if(data.url)window.location.href=data.url;
    else{alert(data.error||'Payment failed');btn.textContent='Unlock';btn.disabled=false}
  }catch(e){alert('Connection error');btn.textContent='Unlock';btn.disabled=false}
});

// ===== PDF =====
document.getElementById('pdfBtn').addEventListener('click',async()=>{
  const btn=document.getElementById('pdfBtn');const orig=btn.innerHTML;
  btn.innerHTML='<div class="spinner" style="width:16px;height:16px;border-width:2px"></div><span>Generating...</span>';btn.disabled=true;
  try{
    const r=await fetch(API+'/generate-report',{method:'POST',headers:{'Authorization':'Bearer '+getToken(),'Content-Type':'application/json'},body:JSON.stringify({results,search_id:searchId,search_date:new Date().toISOString().replace('T',' ').slice(0,19)+' UTC',email:(JSON.parse(localStorage.getItem('protevio_user')||'{}')).email||''})});
    if(!r.ok)throw 0;const b=await r.blob();const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='protevio_report_'+new Date().toISOString().slice(0,10)+'.pdf';a.click();
  }catch(e){alert('Failed to generate report.')}
  btn.innerHTML=orig;btn.disabled=false;
});

// ===== UNLOCK RETURN =====
(function(){
  const p=new URLSearchParams(location.search);const uid=p.get('unlocked');
  if(uid){isUnlocked=true;isFree=false;history.replaceState({},'',location.pathname);
    try{const s=JSON.parse(localStorage.getItem('protevio_pending_unlock')||'null');
    if(s&&s.results){localStorage.removeItem('protevio_pending_unlock');results=s.results;searchId=s.search_id||'';
    sessionStorage.setItem('protevio_results',JSON.stringify({results,search_id:searchId,count:results.length,userPlan,isUnlocked:true,timestamp:Date.now()}));
    document.getElementById('grid').innerHTML='';document.getElementById('ctaSection').style.display='none';render()}}catch(e){}}
  if(p.get('unlock_cancelled')){history.replaceState({},'',location.pathname);localStorage.removeItem('protevio_pending_unlock')}
})();
</script>
</body>
</html>
