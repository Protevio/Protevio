<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="theme-color" content="#1a1f2e"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard — Protevio AI</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#1a1f2e;--bg2:#232a3d;--bg3:#2a3349;--bg4:#333d56;
  --border:#3a4562;--border-h:#4a5878;
  --text:#f0f2f7;--text2:#c4c9d8;--text3:#8891a5;
  --accent:#5b9aff;--accent-bg:rgba(91,154,255,.1);
  --green:#4ade80;--green-bg:rgba(74,222,128,.1);
  --red:#f87171;--red-bg:rgba(248,113,113,.1);
  --gold:#fbbf24;--gold-bg:rgba(251,191,36,.1);
  --purple:#a78bfa;--purple-bg:rgba(167,139,250,.1);
  --cyan:#22d3ee;--cyan-bg:rgba(34,211,238,.1);
}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex}

/* SIDEBAR */
.sidebar{width:230px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:50}
.sidebar__logo{display:flex;align-items:center;gap:10px;padding:20px 18px;border-bottom:1px solid var(--border)}
.sidebar__logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:9px;display:flex;align-items:center;justify-content:center}
.sidebar__logo-icon svg{width:18px;height:18px;fill:#fff}
.sidebar__logo-text{font-size:1.05rem;font-weight:800;letter-spacing:-.02em}
.sidebar__nav{flex:1;padding:16px 10px}
.sidebar__link{display:flex;align-items:center;gap:11px;padding:11px 14px;color:var(--text3);text-decoration:none;font-size:.88rem;font-weight:500;transition:all .15s;border-radius:10px;margin-bottom:2px;cursor:pointer;border:2px solid transparent}
.sidebar__link:hover{background:rgba(91,154,255,.06);color:var(--text2)}
.sidebar__link.active{background:var(--accent-bg);color:var(--accent);border-color:var(--accent);font-weight:700}
.sidebar__link svg{width:18px;height:18px;stroke-width:2;fill:none;flex-shrink:0}
.sidebar__link .lbadge{margin-left:auto;font-size:.65rem;background:var(--accent);color:#fff;padding:2px 7px;border-radius:10px;font-weight:700}
.sidebar__footer{padding:14px 10px;border-top:1px solid var(--border)}
.sidebar__logout{display:flex;align-items:center;gap:10px;width:100%;background:none;border:1px solid var(--border);color:var(--text3);padding:10px 14px;border-radius:10px;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit}
.sidebar__logout:hover{border-color:var(--red);color:var(--red);background:var(--red-bg)}
.sidebar__logout svg{width:18px;height:18px;stroke-width:2;fill:none}

/* MAIN */
.main{margin-left:230px;flex:1;min-height:100vh;padding:28px}
.dh{margin-bottom:28px}
.dh__t{font-size:1.6rem;font-weight:800;margin-bottom:4px}
.dh__s{color:var(--text3);font-size:.9rem}
.dgrid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.dcard{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px;transition:border-color .2s}
.dcard:hover{border-color:var(--border-h)}
.dcard__h{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.dcard__t{display:flex;align-items:center;gap:10px;font-size:1rem;font-weight:700}
.dcard__t svg{width:20px;height:20px;stroke-width:2;fill:none}
.badge{font-size:.72rem;font-weight:700;padding:4px 12px;border-radius:20px;text-transform:uppercase;letter-spacing:.04em}
.badge--free{background:rgba(136,145,165,.15);color:var(--text3)}
.badge--basic{background:var(--accent-bg);color:var(--accent)}
.badge--pro{background:var(--purple-bg);color:var(--purple)}
.badge--unlimited{background:var(--gold-bg);color:var(--gold)}
.irow{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--bg3);border-radius:12px;margin-bottom:10px}
.irow__ic{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.irow__ic svg{width:18px;height:18px;stroke-width:2;fill:none}
.irow__txt{flex:1}
.irow__l{font-size:.82rem;font-weight:600}
.irow__s{font-size:.72rem;color:var(--text3);margin-top:1px}
.irow__act{color:var(--accent);font-size:.8rem;font-weight:600;text-decoration:none;cursor:pointer;background:none;border:none;font-family:inherit}
.irow__act:hover{text-decoration:underline}
.sbox{text-align:center;padding:16px;background:var(--bg3);border-radius:12px}
.sbox__v{font-size:1.8rem;font-weight:800}
.sbox__l{font-size:.75rem;color:var(--text3);margin-top:2px}
.ubar-w{margin-top:14px}
.ubar-h{display:flex;justify-content:space-between;font-size:.82rem;margin-bottom:8px}
.ubar{height:8px;background:var(--bg3);border-radius:4px;overflow:hidden}
.ubar__f{height:100%;border-radius:4px;transition:width .5s}
.abtn{display:inline-flex;align-items:center;gap:8px;padding:10px 22px;border-radius:10px;font-size:.88rem;font-weight:700;cursor:pointer;transition:all .2s;text-decoration:none;border:none;font-family:inherit}
.abtn:hover{transform:translateY(-1px)}
.abtn--p{background:linear-gradient(135deg,var(--accent),var(--purple));color:#fff}
.abtn--p:hover{box-shadow:0 6px 20px rgba(91,154,255,.3)}
.abtn--o{background:none;border:1px solid var(--border);color:var(--text2)}
.abtn--o:hover{border-color:var(--accent);color:var(--accent)}
.abtn svg{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}
.fcard{padding:20px;background:var(--bg3);border-radius:12px;text-align:center}
.fcard__ic{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px}
.fcard__ic svg{width:24px;height:24px;stroke-width:2;fill:none}
.fcard__t{font-size:.92rem;font-weight:700;margin-bottom:6px}
.fcard__d{font-size:.78rem;color:var(--text3);line-height:1.5;margin-bottom:14px}
.fcard__b{display:inline-flex;align-items:center;gap:4px;font-size:.72rem;font-weight:700;color:var(--gold);background:var(--gold-bg);padding:4px 12px;border-radius:8px}
.page{display:none}.page.active{display:block}

/* HISTORY ITEM */
.hi{display:flex;align-items:center;gap:16px;padding:16px;background:var(--bg3);border-radius:12px;margin-bottom:10px;transition:border-color .2s;border:1px solid transparent}
.hi:hover{border-color:var(--border-h)}
.hi__thumb{width:52px;height:52px;border-radius:10px;object-fit:cover;background:var(--bg4);flex-shrink:0}
.hi__info{flex:1}
.hi__top{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.hi__results{font-size:.88rem;font-weight:700}
.hi__time{font-size:.72rem;color:var(--text3)}
.hi__previews{display:flex;gap:4px;margin-top:6px}
.hi__prev{width:32px;height:32px;border-radius:6px;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:.6rem;color:var(--text3);overflow:hidden}
.hi__prev img{width:100%;height:100%;object-fit:cover}
.hi__domains{font-size:.72rem;color:var(--text3);margin-top:4px}
.hi__right{text-align:right;flex-shrink:0}
.hi__sim{font-size:.78rem;color:var(--accent);font-weight:600}

/* ALERT ITEM */
.ai{display:flex;align-items:center;gap:16px;padding:16px;background:var(--bg3);border-radius:12px;margin-bottom:10px;border:1px solid transparent}
.ai:hover{border-color:var(--border-h)}
.ai__thumb{width:52px;height:52px;border-radius:10px;object-fit:cover;background:var(--bg4);flex-shrink:0}
.ai__info{flex:1}
.ai__label{font-size:.88rem;font-weight:700;margin-bottom:2px}
.ai__meta{font-size:.72rem;color:var(--text3)}
.ai__status{font-size:.72rem;font-weight:700;padding:3px 10px;border-radius:6px}
.ai__status--active{background:var(--green-bg);color:var(--green)}
.ai__status--paused{background:var(--gold-bg);color:var(--gold)}
.ai__actions{display:flex;gap:6px}
.ai__btn{padding:6px 12px;border-radius:7px;font-size:.75rem;font-weight:600;cursor:pointer;border:1px solid;font-family:inherit;background:none;transition:all .15s}

/* TAKEDOWN ITEM */
.ti{padding:16px;background:var(--bg3);border-radius:12px;margin-bottom:10px}
.ti__top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.ti__url{font-size:.82rem;font-weight:600;word-break:break-all}
.ti__status{font-size:.72rem;font-weight:700;padding:3px 10px;border-radius:6px}
.ti__status--pending{background:var(--gold-bg);color:var(--gold)}
.ti__status--sent{background:var(--accent-bg);color:var(--accent)}
.ti__status--resolved{background:var(--green-bg);color:var(--green)}
.ti__reason{font-size:.78rem;color:var(--text3);margin-top:4px}
.ti__date{font-size:.7rem;color:var(--text3);margin-top:6px}

/* SETTINGS */
.si{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--bg3);border-radius:12px;margin-bottom:10px}
.si__left{display:flex;align-items:center;gap:12px}
.si__ic{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center}
.si__ic svg{width:18px;height:18px;stroke-width:2;fill:none}
.si__t{font-size:.88rem;font-weight:600}
.si__s{font-size:.72rem;color:var(--text3)}
.toggle{width:44px;height:24px;background:var(--bg4);border-radius:12px;position:relative;cursor:pointer;transition:background .2s;border:none}
.toggle.on{background:var(--accent)}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;top:3px;left:3px;transition:transform .2s}
.toggle.on::after{transform:translateX(20px)}

/* MODAL */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:200;justify-content:center;align-items:center;padding:20px}
.modal-bg.show{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:16px;width:100%;max-width:460px;padding:24px;animation:mIn .2s}
@keyframes mIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
.modal__t{font-size:1.05rem;font-weight:700;margin-bottom:18px}
.modal__f{margin-bottom:14px}
.modal__fl{font-size:.78rem;color:var(--text3);margin-bottom:6px;display:block}
.modal__fi{width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:8px;font-size:.85rem;font-family:inherit;resize:vertical}
.modal__fi:focus{outline:none;border-color:var(--accent)}
.modal__btns{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
.modal__btn{padding:9px 20px;border-radius:9px;font-size:.85rem;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .15s}
.empty{text-align:center;padding:40px;color:var(--text3)}
.empty svg{display:block;margin:0 auto 12px;width:48px;height:48px;stroke:var(--text3);stroke-width:1.5;fill:none}

/* MOBILE TOPBAR */
.mobile-topbar{display:none;position:fixed;top:0;left:0;right:0;height:56px;background:var(--bg2);border-bottom:1px solid var(--border);z-index:90;align-items:center;padding:0 16px;gap:12px}
.mobile-topbar__hamburger{background:none;border:none;cursor:pointer;padding:8px;display:flex;flex-direction:column;gap:5px}
.mobile-topbar__hamburger span{display:block;width:20px;height:2px;background:var(--text);border-radius:2px;transition:all .3s}
.mobile-topbar__logo{display:flex;align-items:center;gap:8px;font-weight:800;font-size:.95rem;color:var(--text)}
.mobile-topbar__logo-icon{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:7px;display:flex;align-items:center;justify-content:center}
.mobile-topbar__logo-icon svg{width:14px;height:14px;fill:#fff}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:95;backdrop-filter:blur(2px)}
.sidebar-overlay.show{display:block}

@media(max-width:768px){
  .mobile-topbar{display:flex}
  .sidebar{transform:translateX(-100%);transition:transform .3s ease;z-index:100;width:260px}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0;padding:16px;padding-top:72px}
  .dgrid{grid-template-columns:1fr}
  .dh__t{font-size:1.3rem}
  .card{padding:16px}
  .card__t{font-size:.8rem}
  .card__v{font-size:1.4rem}
  .hi{flex-wrap:wrap;gap:10px}
  .hi__right{text-align:left}
  .ai{flex-wrap:wrap;gap:10px}
  .ai__actions{width:100%;justify-content:flex-end}
  .ti__top{flex-direction:column;align-items:flex-start;gap:6px}
  .si{flex-direction:column;align-items:flex-start;gap:10px}
  .modal{max-width:calc(100vw - 32px);padding:20px}
  .modal__btns{flex-direction:column}
  .modal__btn{width:100%;text-align:center}
}
@media(max-width:400px){
  .main{padding:12px;padding-top:68px}
  .dh__t{font-size:1.15rem}
  .card__v{font-size:1.2rem}
}
</style>
</head>
<body>

<!-- Mobile Topbar -->
<div class="mobile-topbar">
  <button class="mobile-topbar__hamburger" id="dashHamburger">
    <span></span><span></span><span></span>
  </button>
  <div class="mobile-topbar__logo">
    <div class="mobile-topbar__logo-icon"><svg viewBox="0 0 24 24"><path d="M15 3a6 6 0 00-6 6 6 6 0 006 6 6 6 0 006-6 6 6 0 00-6-6zM3 21a9 9 0 0118 0"/></svg></div>
    Protevio AI
  </div>
</div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<aside class="sidebar" id="dashSidebar">
  <div class="sidebar__logo">
    <div class="sidebar__logo-icon"><svg viewBox="0 0 24 24"><path d="M15 3a6 6 0 00-6 6 6 6 0 006 6 6 6 0 006-6 6 6 0 00-6-6zM3 21a9 9 0 0118 0"/></svg></div>
    <span class="sidebar__logo-text">Protevio AI</span>
  </div>
  <nav class="sidebar__nav">
    <a class="sidebar__link active" data-page="dashboard"><svg viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>My Dashboard</a>
    <a class="sidebar__link" href="/testhomepage"><svg viewBox="0 0 24 24" stroke="currentColor"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Search</a>
    <a class="sidebar__link" data-page="history"><svg viewBox="0 0 24 24" stroke="currentColor"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></svg>Search History<span class="lbadge" id="histBadge" style="display:none">0</span></a>
    <a class="sidebar__link" data-page="exported"><svg viewBox="0 0 24 24" stroke="currentColor"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Exported Results</a>
    <a class="sidebar__link" data-page="alerts"><svg viewBox="0 0 24 24" stroke="currentColor"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>Alerts<span class="lbadge" id="alertBadge" style="display:none">0</span></a>
    <a class="sidebar__link" data-page="protect"><svg viewBox="0 0 24 24" stroke="currentColor"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>PROtect</a>
    <a class="sidebar__link" data-page="settings"><svg viewBox="0 0 24 24" stroke="currentColor"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>Settings</a>
    <div id="adminLink" style="display:none;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
      <a class="sidebar__link" href="/admin" style="color:var(--red)"><svg viewBox="0 0 24 24" stroke="currentColor"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>Admin Panel</a>
    </div>
  </nav>
  <div class="sidebar__footer">
    <button class="sidebar__logout" id="logoutBtn"><svg viewBox="0 0 24 24" stroke="currentColor"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Log Out</button>
  </div>
</aside>

<div class="main">

  <!-- ===== DASHBOARD ===== -->
  <div class="page active" id="page-dashboard">
    <div class="dh"><div class="dh__t" id="greeting">Welcome back</div><div class="dh__s">Here's your Protevio AI account overview</div></div>
    <div class="dgrid">
      <div class="dcard">
        <div class="dcard__h"><div class="dcard__t"><svg viewBox="0 0 24 24" stroke="var(--accent)"><rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/></svg>My Subscription</div><div class="badge" id="planBadge">Free</div></div>
        <div style="font-size:.88rem;color:var(--text2);margin-bottom:14px">Plan: <strong id="planName" style="color:var(--text)">Free</strong></div>
        <div class="irow"><div class="irow__ic" style="background:var(--accent-bg)"><svg viewBox="0 0 24 24" stroke="var(--accent)"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div><div class="irow__txt"><div class="irow__l" id="userEmail">—</div><div class="irow__s" id="userCreated">Created: —</div></div></div>
        <div class="irow"><div class="irow__ic" style="background:var(--purple-bg)"><svg viewBox="0 0 24 24" stroke="var(--purple)"><rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/></svg></div><div class="irow__txt"><div class="irow__l">Orders & Invoices</div><div class="irow__s">Manage your payment history</div></div><button class="irow__act" onclick="alert('Payment management coming soon.')">Manage →</button></div>
        <div style="margin-top:16px"><a href="/pricing" class="abtn abtn--o"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/></svg>Explore Pricing</a></div>
      </div>
      <div class="dcard">
        <div class="dcard__h"><div class="dcard__t"><svg viewBox="0 0 24 24" stroke="var(--green)"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Search Activity</div><div style="text-align:right"><div style="font-size:.82rem;color:var(--text2)">You have <strong style="color:var(--accent)" id="searchesLeft">—</strong> left today</div><div style="font-size:.72rem;color:var(--text3)">Total Searches: <span id="totalSearches">0</span></div></div></div>
        <div class="ubar-w" style="margin-bottom:18px"><div class="ubar-h"><span style="color:var(--text2)">Daily Usage</span><span style="color:var(--text3)" id="usageText">0 / 10</span></div><div class="ubar"><div class="ubar__f" id="usageBar" style="width:0;background:var(--green)"></div></div></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px"><div class="sbox"><div class="sbox__v" id="statToday" style="color:var(--accent)">0</div><div class="sbox__l">Today</div></div><div class="sbox"><div class="sbox__v" id="statTotal" style="color:var(--purple)">0</div><div class="sbox__l">All Time</div></div></div>
        <a href="/testhomepage" class="abtn abtn--p" style="width:100%;justify-content:center"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Perform Search</a>
      </div>
    </div>
    <div class="dgrid">
      <div class="dcard">
        <div class="dcard__h"><div class="dcard__t"><svg viewBox="0 0 24 24" stroke="var(--gold)"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>Alerts</div><div style="font-size:.88rem" id="alertCount"><strong style="color:var(--accent)">0</strong><span style="color:var(--text3)"> / 0</span></div></div>
        <div id="dashAlerts"></div>
      </div>
      <div class="dcard">
        <div class="dcard__h"><div class="dcard__t"><svg viewBox="0 0 24 24" stroke="var(--green)"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>PROtect</div></div>
        <div id="dashProtect"></div>
      </div>
    </div>
  </div>

  <!-- ===== SEARCH HISTORY ===== -->
  <div class="page" id="page-history">
    <div class="dh"><div class="dh__t">Search History</div><div class="dh__s">Your recent face search activity with result previews</div></div>
    <div class="dcard" id="historyContent"><div class="empty">Loading...</div></div>
  </div>

  <!-- ===== EXPORTED RESULTS ===== -->
  <div class="page" id="page-exported">
    <div class="dh"><div class="dh__t">Exported Results</div><div class="dh__s">Download detailed reports from your previous searches</div></div>
    <div class="dcard" id="exportContent"><div class="empty">Loading...</div></div>
  </div>

  <!-- ===== ALERTS ===== -->
  <div class="page" id="page-alerts">
    <div class="dh" style="display:flex;align-items:center;justify-content:space-between">
      <div><div class="dh__t">Alerts</div><div class="dh__s">Monitor the web for new appearances of a face</div></div>
      <button class="abtn abtn--p" id="newAlertBtn" style="display:none" onclick="showNewAlert()"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>New Alert</button>
    </div>
    <div class="dcard" id="alertsContent"><div class="empty">Loading...</div></div>
  </div>

  <!-- ===== PROTECT ===== -->
  <div class="page" id="page-protect">
    <div class="dh" style="display:flex;align-items:center;justify-content:space-between">
      <div><div class="dh__t">PROtect</div><div class="dh__s">Request removal of your images from search results</div></div>
      <button class="abtn abtn--p" id="newTakedownBtn" style="display:none" onclick="showNewTakedown()"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>New Request</button>
    </div>
    <div class="dcard" id="protectContent"><div class="empty">Loading...</div></div>
  </div>

  <!-- ===== SETTINGS ===== -->
  <div class="page" id="page-settings">
    <div class="dh"><div class="dh__t">Settings</div><div class="dh__s">Manage your account preferences</div></div>
    <div class="dcard">
      <div class="si"><div class="si__left"><div class="si__ic" style="background:var(--accent-bg)"><svg viewBox="0 0 24 24" stroke="var(--accent)"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div><div class="si__t" id="sName">—</div><div class="si__s" id="sEmail">—</div></div></div></div>
      <div class="si"><div class="si__left"><div class="si__ic" style="background:var(--green-bg)"><svg viewBox="0 0 24 24" stroke="var(--green)"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><div><div class="si__t">Safe Search</div><div class="si__s">Filter explicit results from searches</div></div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
      <div class="si"><div class="si__left"><div class="si__ic" style="background:var(--purple-bg)"><svg viewBox="0 0 24 24" stroke="var(--purple)"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div><div><div class="si__t">Email Notifications</div><div class="si__s">Receive alerts about new matches</div></div></div><button class="toggle" onclick="this.classList.toggle('on')"></button></div>
      <div class="si"><div class="si__left"><div class="si__ic" style="background:var(--gold-bg)"><svg viewBox="0 0 24 24" stroke="var(--gold)"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg></div><div><div class="si__t">Two-Factor Authentication</div><div class="si__s">Add extra security to your account</div></div></div><button class="toggle" onclick="this.classList.toggle('on')"></button></div>
      <div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border)"><button class="abtn abtn--o" style="color:var(--red);border-color:var(--red)" onclick="alert('Contact support@protevio.com to delete your account.')"><svg viewBox="0 0 24 24" style="stroke:var(--red)"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>Delete Account</button></div>
    </div>
  </div>
</div>

<!-- ALERT MODAL -->
<div class="modal-bg" id="alertModal">
  <div class="modal">
    <div class="modal__t">New Face Alert</div>
    <p style="font-size:.85rem;color:var(--text3);margin-bottom:16px">To create an alert, first perform a face search. After results appear, you can set up monitoring for that face from here.</p>
    <div class="modal__f"><label class="modal__fl">Alert Label</label><input class="modal__fi" id="alertLabel" placeholder="e.g. My face, Client photo" value="My face"></div>
    <div class="modal__f"><label class="modal__fl">Face ID (from search)</label><input class="modal__fi" id="alertFaceId" placeholder="Paste face ID from search results"></div>
    <div class="modal__btns">
      <button class="modal__btn" style="background:var(--bg3);color:var(--text2)" onclick="closeAlertModal()">Cancel</button>
      <button class="modal__btn" style="background:var(--accent);color:#fff" onclick="submitAlert()">Create Alert</button>
    </div>
  </div>
</div>

<!-- TAKEDOWN MODAL -->
<div class="modal-bg" id="takedownModal">
  <div class="modal">
    <div class="modal__t">New Takedown Request</div>
    <p style="font-size:.85rem;color:var(--text3);margin-bottom:16px">Submit a request to remove your image from our search results and notify the website owner.</p>
    <div class="modal__f"><label class="modal__fl">Image URL or Source Page URL</label><input class="modal__fi" id="tdUrl" placeholder="https://example.com/photo.jpg"></div>
    <div class="modal__f"><label class="modal__fl">Website Domain</label><input class="modal__fi" id="tdDomain" placeholder="e.g. example.com"></div>
    <div class="modal__f"><label class="modal__fl">Reason for Removal</label><textarea class="modal__fi" id="tdReason" rows="3" placeholder="I want this image removed from search results because...">I want this image removed from search results. This is my photo published without my consent.</textarea></div>
    <div class="modal__btns">
      <button class="modal__btn" style="background:var(--bg3);color:var(--text2)" onclick="closeTdModal()">Cancel</button>
      <button class="modal__btn" style="background:var(--green);color:#fff" onclick="submitTakedown()">Submit Request</button>
    </div>
  </div>
</div>

<script>
const API = 'https://api.protevio.com/api';
const token = localStorage.getItem('protevio_token');
if(!token) window.location.href = '/login';

let userPlan = 'free';
let isPro = false;

const hdr = () => ({'Authorization':'Bearer '+token,'Content-Type':'application/json'});

document.getElementById('logoutBtn').onclick = () => {
  localStorage.removeItem('protevio_token');
  localStorage.removeItem('protevio_user');
  window.location.href = '/login';
};

// Mobile sidebar toggle
const dashHamburger = document.getElementById('dashHamburger');
const dashSidebar = document.getElementById('dashSidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');
function openSidebar(){ dashSidebar.classList.add('open'); sidebarOverlay.classList.add('show'); document.body.style.overflow='hidden'; }
function closeSidebar(){ dashSidebar.classList.remove('open'); sidebarOverlay.classList.remove('show'); document.body.style.overflow=''; }
dashHamburger.addEventListener('click', openSidebar);
sidebarOverlay.addEventListener('click', closeSidebar);

document.querySelectorAll('.sidebar__link[data-page]').forEach(l => {
  l.onclick = e => {
    e.preventDefault();
    document.querySelectorAll('.sidebar__link').forEach(x => x.classList.remove('active'));
    l.classList.add('active');
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-'+l.dataset.page).classList.add('active');
    closeSidebar();
  };
});

function timeAgo(str) {
  if(!str) return '—';
  const s = Math.floor((Date.now() - new Date(str).getTime()) / 1000);
  if(s < 60) return 'just now';
  if(s < 3600) return Math.floor(s/60) + 'm ago';
  if(s < 86400) return Math.floor(s/3600) + 'h ago';
  if(s < 604800) return Math.floor(s/86400) + 'd ago';
  return new Date(str).toLocaleDateString('en-GB');
}

function lockedCard(icon, color, bg, title, desc) {
  return `<div class="fcard"><div class="fcard__ic" style="background:${bg}"><svg viewBox="0 0 24 24" stroke="${color}">${icon}</svg></div><div class="fcard__t">${title}</div><div class="fcard__d">${desc}</div><div class="fcard__b"><svg viewBox="0 0 24 24" style="width:12px;height:12px;stroke:currentColor;stroke-width:2;fill:none"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Upgrade to Pro</div></div>`;
}

// ===== LOAD DASHBOARD =====
async function loadDashboard() {
  try {
    const res = await fetch(API+'/auth/me', {headers:{'Authorization':'Bearer '+token}});
    if(res.status===401){window.location.href='/login';return;}
    const u = await res.json();
    localStorage.setItem('protevio_user', JSON.stringify(u));
    
    userPlan = u.plan || 'free';
    isPro = ['pro','unlimited'].includes(userPlan);
    
    const limits = {free:10,basic:50,pro:200,unlimited:-1};
    const limit = limits[userPlan]||10;
    const used = u.searches_today||0;
    const total = u.total_searches||0;
    const rem = limit===-1?'∞':Math.max(0,limit-used);
    const pct = limit===-1?3:Math.min(100,Math.round((used/limit)*100));
    const barC = pct>80?'var(--red)':pct>50?'var(--gold)':'var(--green)';
    
    const hr = new Date().getHours();
    const g = hr<12?'Good morning':hr<18?'Good afternoon':'Good evening';
    document.getElementById('greeting').textContent = g+', '+(u.name||u.username);
    
    const pc = userPlan.charAt(0).toUpperCase()+userPlan.slice(1);
    document.getElementById('planBadge').textContent = pc;
    document.getElementById('planBadge').className = 'badge badge--'+userPlan;
    document.getElementById('planName').textContent = pc;
    document.getElementById('userEmail').textContent = u.email||u.username;
    document.getElementById('userCreated').textContent = 'Created: '+(u.created_at?new Date(u.created_at).toLocaleDateString('en-GB'):'—');
    document.getElementById('searchesLeft').textContent = rem;
    document.getElementById('totalSearches').textContent = total;
    document.getElementById('usageText').textContent = limit===-1?used+' / Unlimited':used+' / '+limit;
    document.getElementById('usageBar').style.width = pct+'%';
    document.getElementById('usageBar').style.background = barC;
    document.getElementById('statToday').textContent = used;
    document.getElementById('statTotal').textContent = total;
    document.getElementById('sName').textContent = u.name||u.username;
    document.getElementById('sEmail').textContent = u.email||'—';
    if(u.role==='admin') document.getElementById('adminLink').style.display='block';
    
    // Show/hide pro buttons
    if(isPro) {
      document.getElementById('newAlertBtn').style.display = 'inline-flex';
      document.getElementById('newTakedownBtn').style.display = 'inline-flex';
    }
    
    loadHistory();
    loadAlerts();
    loadTakedowns();
    loadExports();
  } catch(e){console.error(e);}
}

// ===== SEARCH HISTORY =====
async function loadHistory() {
  const el = document.getElementById('historyContent');
  try {
    const res = await fetch(API+'/search-history?limit=20', {headers:{'Authorization':'Bearer '+token}});
    const d = await res.json();
    const h = d.history || [];
    
    const badge = document.getElementById('histBadge');
    if(h.length>0){badge.textContent=h.length;badge.style.display='inline';}
    
    if(h.length===0){
      el.innerHTML = '<div class="empty"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>No searches yet<br><br><a href="/testhomepage" style="color:var(--accent);font-weight:600;text-decoration:none">Perform your first search →</a></div>';
      return;
    }
    
    el.innerHTML = h.map(s => {
      const thumb = s.face_thumbnail ? `<img class="hi__thumb" src="data:image/jpeg;base64,${s.face_thumbnail}">` : '<div class="hi__thumb" style="display:flex;align-items:center;justify-content:center"><svg viewBox="0 0 24 24" style="width:24px;height:24px;stroke:var(--text3);stroke-width:2;fill:none"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>';
      
      const tops = (s.top_results||[]).slice(0,4);
      const domains = [...new Set(tops.map(t=>t.domain).filter(Boolean))].slice(0,3);
      const topSim = tops.length ? Math.round(tops[0].similarity) + '%' : '';
      
      const previews = tops.map(t => 
        `<div class="hi__prev" title="${t.domain}">${t.domain ? t.domain.charAt(0).toUpperCase() : '?'}</div>`
      ).join('');
      
      return `<div class="hi">
        ${thumb}
        <div class="hi__info">
          <div class="hi__top"><span class="hi__results">${s.results} results found</span></div>
          <div class="hi__time">${timeAgo(s.time)}</div>
          ${domains.length ? '<div class="hi__domains">'+domains.join(', ')+'</div>' : ''}
          ${previews ? '<div class="hi__previews">'+previews+'</div>' : ''}
        </div>
        <div class="hi__right">
          ${topSim ? '<div class="hi__sim">Best: '+topSim+'</div>' : ''}
        </div>
      </div>`;
    }).join('');
  } catch(e){ el.innerHTML = '<div class="empty">Failed to load history</div>'; }
}

// ===== ALERTS =====
async function loadAlerts() {
  try {
    const res = await fetch(API+'/alerts', {headers:{'Authorization':'Bearer '+token}});
    const d = await res.json();
    const alerts = d.alerts || [];
    
    // Dashboard card
    const dashEl = document.getElementById('dashAlerts');
    const countEl = document.getElementById('alertCount');
    
    if(!isPro) {
      countEl.innerHTML = '<strong style="color:var(--accent)">0</strong><span style="color:var(--text3)"> / 0</span>';
      dashEl.innerHTML = lockedCard('<path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/>', 'var(--gold)', 'var(--gold-bg)', 'Face Monitoring Alerts', 'Get notified when new photos matching your face appear online. Set up automated monitoring to protect your digital identity.');
      document.getElementById('alertsContent').innerHTML = '<div style="text-align:center;padding:48px 24px"><div class="fcard__ic" style="background:var(--gold-bg);margin:0 auto 16px"><svg viewBox="0 0 24 24" stroke="var(--gold)" style="width:28px;height:28px;stroke-width:2;fill:none"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></div><h3 style="font-size:1.1rem;font-weight:700;margin-bottom:8px">Automated Face Monitoring</h3><p style="color:var(--text3);font-size:.88rem;line-height:1.6;max-width:420px;margin:0 auto 20px">Upload a face and we\'ll continuously scan newly indexed content to alert you when matching photos appear online.</p><div class="fcard__b" style="font-size:.8rem;padding:6px 16px"><svg viewBox="0 0 24 24" style="width:14px;height:14px;stroke:currentColor;stroke-width:2;fill:none"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Available with Pro Plan</div></div>';
      return;
    }
    
    const maxAlerts = userPlan === 'unlimited' ? 20 : 5;
    countEl.innerHTML = `<strong style="color:var(--accent)">${alerts.length}</strong><span style="color:var(--text3)"> / ${maxAlerts}</span>`;
    
    const badge = document.getElementById('alertBadge');
    if(alerts.length>0){badge.textContent=alerts.length;badge.style.display='inline';}
    
    // Dashboard mini view
    if(alerts.length === 0) {
      dashEl.innerHTML = '<div style="text-align:center;padding:16px;color:var(--text3);font-size:.85rem">No active alerts.<br><a href="#" onclick="document.querySelector(\'[data-page=alerts]\').click();return false" style="color:var(--accent);font-weight:600">Set up monitoring →</a></div>';
    } else {
      dashEl.innerHTML = alerts.slice(0,2).map(a => `<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg3);border-radius:8px;margin-bottom:6px;font-size:.82rem"><span class="ai__status ai__status--${a.status}">${a.status}</span><span style="font-weight:600">${a.label}</span><span style="color:var(--text3);margin-left:auto">${a.matches} matches</span></div>`).join('') + (alerts.length > 2 ? `<div style="text-align:center;padding:8px;font-size:.78rem"><a href="#" onclick="document.querySelector('[data-page=alerts]').click();return false" style="color:var(--accent)">View all ${alerts.length} alerts →</a></div>` : '');
    }
    
    // Full alerts page
    const alertsEl = document.getElementById('alertsContent');
    if(alerts.length === 0) {
      alertsEl.innerHTML = '<div class="empty"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>No alerts set up yet.<br><br>Click "New Alert" to start monitoring a face.</div>';
    } else {
      alertsEl.innerHTML = alerts.map(a => {
        const thumb = a.face_thumbnail ? `<img class="ai__thumb" src="data:image/jpeg;base64,${a.face_thumbnail}">` : '<div class="ai__thumb" style="display:flex;align-items:center;justify-content:center"><svg viewBox="0 0 24 24" style="width:24px;height:24px;stroke:var(--text3);stroke-width:2;fill:none"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>';
        return `<div class="ai">${thumb}<div class="ai__info"><div class="ai__label">${a.label}</div><div class="ai__meta">${a.matches} matches found · Created ${timeAgo(a.created_at)}${a.last_checked ? ' · Last checked '+timeAgo(a.last_checked) : ''}</div></div><span class="ai__status ai__status--${a.status}">${a.status}</span><div class="ai__actions"><button class="ai__btn" style="border-color:var(--gold);color:var(--gold)" onclick="toggleAlert(${a.id})">${a.status==='active'?'Pause':'Resume'}</button><button class="ai__btn" style="border-color:var(--red);color:var(--red)" onclick="deleteAlert(${a.id})">Delete</button></div></div>`;
      }).join('');
    }
  } catch(e) { console.error('Alerts error:', e); }
}

// ===== TAKEDOWNS (PROTECT) =====
async function loadTakedowns() {
  try {
    const res = await fetch(API+'/takedowns', {headers:{'Authorization':'Bearer '+token}});
    const d = await res.json();
    const items = d.takedowns || [];
    
    const dashEl = document.getElementById('dashProtect');
    
    if(!isPro) {
      dashEl.innerHTML = lockedCard('<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/>', 'var(--green)', 'var(--green-bg)', 'PROtect Your Photos', 'Request removal of your photos from search results. Submit takedown requests for images found across our indexed database.');
      document.getElementById('protectContent').innerHTML = '<div style="text-align:center;padding:48px 24px"><div class="fcard__ic" style="background:var(--green-bg);margin:0 auto 16px"><svg viewBox="0 0 24 24" stroke="var(--green)" style="width:28px;height:28px;stroke-width:2;fill:none"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg></div><h3 style="font-size:1.1rem;font-weight:700;margin-bottom:8px">PROtect Your Digital Identity</h3><p style="color:var(--text3);font-size:.88rem;line-height:1.6;max-width:420px;margin:0 auto 20px">Found your photos on unauthorized websites? Submit DMCA takedown requests and have your images removed.</p><div class="fcard__b" style="font-size:.8rem;padding:6px 16px"><svg viewBox="0 0 24 24" style="width:14px;height:14px;stroke:currentColor;stroke-width:2;fill:none"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Available with Pro Plan</div></div>';
      return;
    }
    
    // Dashboard mini
    if(items.length === 0) {
      dashEl.innerHTML = '<div style="text-align:center;padding:16px;color:var(--text3);font-size:.85rem">No takedown requests yet.<br><a href="#" onclick="document.querySelector(\'[data-page=protect]\').click();return false" style="color:var(--accent);font-weight:600">Submit a request →</a></div>';
    } else {
      const pending = items.filter(t=>t.status==='pending').length;
      const resolved = items.filter(t=>t.status==='resolved').length;
      dashEl.innerHTML = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div class="sbox"><div class="sbox__v" style="color:var(--gold)">${pending}</div><div class="sbox__l">Pending</div></div><div class="sbox"><div class="sbox__v" style="color:var(--green)">${resolved}</div><div class="sbox__l">Resolved</div></div></div>`;
    }
    
    // Full page
    const el = document.getElementById('protectContent');
    if(items.length === 0) {
      el.innerHTML = '<div class="empty"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>No takedown requests yet.<br><br>Click "New Request" to submit a removal request.</div>';
    } else {
      el.innerHTML = items.map(t => `<div class="ti"><div class="ti__top"><div class="ti__url">${t.url || t.face_id || '—'}</div><span class="ti__status ti__status--${t.status}">${t.status}</span></div>${t.domain?'<div style="font-size:.78rem;color:var(--accent)">'+t.domain+'</div>':''}<div class="ti__reason">${t.reason||''}</div><div class="ti__date">Submitted ${timeAgo(t.created_at)}</div></div>`).join('');
    }
  } catch(e) { console.error('Takedowns error:', e); }
}

// ===== EXPORTS =====
async function loadExports() {
  const el = document.getElementById('exportContent');
  try {
    const res = await fetch(API+'/exports', {headers:{'Authorization':'Bearer '+token}});
    const d = await res.json();
    
    if(d.locked) {
      el.innerHTML = '<div style="text-align:center;padding:48px 24px"><div class="fcard__ic" style="background:var(--accent-bg);margin:0 auto 16px"><svg viewBox="0 0 24 24" stroke="var(--accent)" style="width:28px;height:28px;stroke-width:2;fill:none"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div><h3 style="font-size:1.1rem;font-weight:700;margin-bottom:8px">Export Search Reports</h3><p style="color:var(--text3);font-size:.88rem;line-height:1.6;max-width:420px;margin:0 auto 20px">Download detailed PDF reports of your search results including all matched faces, source URLs, and similarity scores.</p><div class="fcard__b" style="font-size:.8rem;padding:6px 16px"><svg viewBox="0 0 24 24" style="width:14px;height:14px;stroke:currentColor;stroke-width:2;fill:none"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>Available with Pro Plan</div></div>';
      return;
    }
    
    const exports = d.exports || [];
    if(exports.length === 0) {
      el.innerHTML = '<div class="empty"><svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>No exported results yet.<br>Perform a search first, then your results will appear here for export.</div>';
      return;
    }
    
    el.innerHTML = exports.map(s => {
      const thumb = s.face_thumbnail ? `<img class="hi__thumb" src="data:image/jpeg;base64,${s.face_thumbnail}">` : '<div class="hi__thumb" style="display:flex;align-items:center;justify-content:center"><svg viewBox="0 0 24 24" style="width:24px;height:24px;stroke:var(--text3);stroke-width:2;fill:none"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>';
      const domains = [...new Set((s.top_results||[]).map(t=>t.domain).filter(Boolean))].slice(0,3);
      return `<div class="hi">${thumb}<div class="hi__info"><div class="hi__top"><span class="hi__results">${s.results} results</span><span class="hi__time">${timeAgo(s.time)}</span></div>${domains.length?'<div class="hi__domains">'+domains.join(', ')+'</div>':''}</div><div class="hi__right"><button class="abtn abtn--o" style="padding:6px 14px;font-size:.78rem" onclick="exportPDF(${s.id})"><svg viewBox="0 0 24 24" style="width:14px;height:14px"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Export PDF</button></div></div>`;
    }).join('');
  } catch(e) { el.innerHTML = '<div class="empty">Failed to load exports</div>'; }
}

// ===== ALERT ACTIONS =====
function showNewAlert() { document.getElementById('alertModal').classList.add('show'); }
function closeAlertModal() { document.getElementById('alertModal').classList.remove('show'); }
document.getElementById('alertModal').onclick = e => { if(e.target.id==='alertModal') closeAlertModal(); };

async function submitAlert() {
  const label = document.getElementById('alertLabel').value.trim() || 'My face';
  const faceId = document.getElementById('alertFaceId').value.trim();
  try {
    const res = await fetch(API+'/alerts', {method:'POST',headers:hdr(),body:JSON.stringify({label,face_id:faceId||null})});
    const d = await res.json();
    if(d.error) { alert(d.error); return; }
    closeAlertModal();
    loadAlerts();
  } catch(e) { alert('Failed to create alert'); }
}

async function toggleAlert(id) {
  await fetch(API+'/alerts/'+id+'/toggle', {method:'POST',headers:hdr()});
  loadAlerts();
}

async function deleteAlert(id) {
  if(!confirm('Delete this alert?')) return;
  await fetch(API+'/alerts/'+id, {method:'DELETE',headers:hdr()});
  loadAlerts();
}

// ===== TAKEDOWN ACTIONS =====
function showNewTakedown() { document.getElementById('takedownModal').classList.add('show'); }
function closeTdModal() { document.getElementById('takedownModal').classList.remove('show'); }
document.getElementById('takedownModal').onclick = e => { if(e.target.id==='takedownModal') closeTdModal(); };

async function submitTakedown() {
  const url = document.getElementById('tdUrl').value.trim();
  const domain = document.getElementById('tdDomain').value.trim();
  const reason = document.getElementById('tdReason').value.trim();
  if(!url){alert('Please enter a URL');return;}
  try {
    const res = await fetch(API+'/takedowns', {method:'POST',headers:hdr(),body:JSON.stringify({url,domain,reason})});
    const d = await res.json();
    if(d.error){alert(d.error);return;}
    closeTdModal();
    loadTakedowns();
  } catch(e){alert('Failed to submit request');}
}

// ===== EXPORT PDF =====
async function exportPDF(searchId) {
  // Direct download via hidden link - avoids CORS issues with binary responses
  const url = API + '/exports/' + searchId + '/pdf?token=' + token;
  window.open(url, '_blank');
}

loadDashboard();
</script>
</body>
</html>
